<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Shield Match</title>
<style>
 body {
  font-family: Arial, sans-serif;
  background: #f0f4f8;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
  margin: 0;
  overflow: hidden;
}

h1 { margin-bottom: 15px; text-align: center; }

#game-board {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-template-rows: repeat(4, 1fr);
  gap: 12px;
  max-width: 600px;
  width: 100%;
  justify-content: center;
}

.card {
  width: 100%;
  aspect-ratio: 1/1;
  perspective: 800px;
  cursor: pointer;
  position: relative;
}

.card-inner {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  width: 100%; height: 100%;
  text-align: center;
  transition: transform 0.5s;
  transform-style: preserve-3d;
}

.card.flipped .card-inner { transform: rotateY(180deg); cursor: default; }

.card-front, .card-back {
  position: absolute;
  width: 100%; height: 100%;
  border-radius: 10px;
  backface-visibility: hidden;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  display: flex;
  justify-content: center;
  align-items: center;
}

.card-front { background: #1565c0; color: white; font-weight: bold; font-size: 1.1rem; }
.card-back { background: rgb(207, 205, 205); transform: rotateY(180deg); border: 2px solid #ddd; }

.card-back img { width: 75%; height: auto; border-radius: 5px; object-fit: contain; }

#score, #timer, #level {
  margin-top: 20px;
  font-size: 20px;
  font-weight: bold;
}

#message { margin-top: 15px; font-size: 18px; color: green; height: 24px; }

#restart-btn {
  padding: 10px 22px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;

  background: linear-gradient(135deg, #1e90ff, #1565c0);
  color: white;
  border: none;
  border-radius: 8px;

  box-shadow: 0 4px 8px rgba(30, 144, 255, 0.35);
  transition: all 0.2s ease;
}


@media (max-width: 480px) {
  #game-board { grid-template-columns: repeat(4,1fr); grid-template-rows: repeat(4,1fr); gap:8px; max-width:100%; }
  .card-back img { width: 66%; }
  #score, #timer, #level { font-size: 18px; }
  #message { font-size:16px; }
  #restart-btn { font-size:14px; padding:6px 14px; }
  .logo img {
    max-width: 300px;
  }
}



</style>
</head>
<body>

<h1 class="logo">
  <img src="logo.png" alt="Shield Match">
</h1>

<div id="game-board"></div>

<div id="level">Nivel: 1</div>
<div id="score">Pares encontrados: 0</div>
<div id="timer">Tiempo: 0s</div>
<div id="message"></div>
<button id="restart-btn">Reiniciar</button>

<script type="module">
import { flags } from './flags.js';

const gameBoard = document.getElementById('game-board');
const scoreDisplay = document.getElementById('score');
const timerDisplay = document.getElementById('timer');
const messageDisplay = document.getElementById('message');
const restartBtn = document.getElementById('restart-btn');
const levelDisplay = document.getElementById('level');

let cards = [], flippedCards = [], matchedPairs = 0, totalPairs = 8;
let timer = 0, timerInterval = null;
let currentLevel = 1, maxLevels = 10;

// El tiempo base será 200s y reducimos 10s por nivel
function getLevelTime(level) { return Math.max(30, 200 - (level-1)*10); }

function shuffle(array) {
  for(let i=array.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
  return array;
}

function createCards() {
  const selectedFlags = [];
  const used = new Set();

  while(selectedFlags.length < 8){
    const randomFlag = flags[Math.floor(Math.random() * flags.length)];
    if(!used.has(randomFlag.country)){
      used.add(randomFlag.country);
      selectedFlags.push(randomFlag);
    }
  }

  const doubled = [...selectedFlags, ...selectedFlags];
  cards = shuffle(doubled.map((flag,index)=>({
    id:index,
    country:flag.country,
    img:flag.img,
    matched:false
  })));

  gameBoard.innerHTML = '';
  cards.forEach((card,index)=>{
    const cardElem = document.createElement('div');
    cardElem.classList.add('card');
    cardElem.dataset.index = index;
    cardElem.innerHTML = `
      <div class="card-inner">
        <div class="card-front">?</div>
        <div class="card-back"><img src="${card.img}" alt="Bandera de ${card.country}" /></div>
      </div>
    `;
    gameBoard.appendChild(cardElem);
  });

  matchedPairs = 0;
  flippedCards = [];
  scoreDisplay.textContent = `Pares encontrados: 0`;
  messageDisplay.textContent = '';
  totalPairs = selectedFlags.length;
  levelDisplay.textContent = `Nivel: ${currentLevel}`;

  resetTimer();
  startTimer();
  gameBoard.style.pointerEvents='auto';
}

function flipCard(cardElem){
  if(flippedCards.length>=2 || cardElem.classList.contains('flipped')) return;
  cardElem.classList.add('flipped');
  flippedCards.push(cardElem);
  if(flippedCards.length===2) checkMatch();
}

function checkMatch(){
  const [cardA, cardB]=flippedCards;
  const indexA=parseInt(cardA.dataset.index);
  const indexB=parseInt(cardB.dataset.index);

  if(cards[indexA].country===cards[indexB].country){
    cards[indexA].matched=true;
    cards[indexB].matched=true;
    matchedPairs++;
    scoreDisplay.textContent=`Pares encontrados: ${matchedPairs}`;
    flippedCards=[];

    if(matchedPairs===totalPairs){
      stopTimer();
      if(currentLevel<maxLevels){
        messageDisplay.textContent=`¡Nivel ${currentLevel} completado! Siguiente nivel...`;
        currentLevel++;
        setTimeout(createCards,1500);
      } else {
        messageDisplay.textContent='¡Felicidades! Has completado el juego';
        gameBoard.style.pointerEvents='none';
      }
    }
  } else {
    setTimeout(()=>{
      cardA.classList.remove('flipped');
      cardB.classList.remove('flipped');
      flippedCards=[];
    },1000);
  }
}

function startTimer(){
  timer=0;
  const levelTime = getLevelTime(currentLevel);
  timerDisplay.textContent=`Tiempo: ${levelTime}s`;
  stopTimer();
  timerInterval = setInterval(()=>{
    timer++;
    const remaining = levelTime-timer;
    timerDisplay.textContent=`Tiempo: ${remaining}s`;
    if(remaining<=0){
      stopTimer();
      messageDisplay.textContent='¡Tiempo agotado! Intenta de nuevo.';
      gameBoard.style.pointerEvents='none';
    }
  },1000);
}

function stopTimer(){ clearInterval(timerInterval); }
function resetTimer(){ stopTimer(); timer=0; }

gameBoard.addEventListener('click',(e)=>{
  const cardElem = e.target.closest('.card');
  if(!cardElem) return;
  flipCard(cardElem);
});

restartBtn.addEventListener('click',()=>{
  currentLevel=1;
  createCards();
});

createCards();

</script>

</body>
</html>
